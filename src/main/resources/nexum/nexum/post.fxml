<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.*?>

<VBox maxHeight="600" maxWidth="600" minHeight="300" minWidth="400" prefHeight="500" prefWidth="500" spacing="12" styleClass="main-container" stylesheets="@styles/post.css" xmlns="http://javafx.com/javafx/17.0.12" xmlns:fx="http://javafx.com/fxml/1" fx:controller="nexum.nexum.PostController">
    <padding>
        <Insets bottom="15" left="20" right="20" top="15" />
    </padding>

    <!-- ... (Top Bar and User Info Section are unchanged) ... -->
    <BorderPane>
        <center>
            <Label styleClass="title-label" text="Post and Connect" />
        </center>
        <right>
            <StackPane styleClass="close-button-pane" BorderPane.alignment="CENTER">
                <SVGPath content="M 0,0 L 10,10 M 10,0 L 0,10" styleClass="close-icon" />
            </StackPane>
        </right>
    </BorderPane>
    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="user-info-box">
        <children>
            <StackPane styleClass="user-icon-pane">
                <SVGPath content="M 12 12 A 4 4 0 1 1 12 4 A 4 4 0 0 1 12 12 M 12 14 C 8.68 14 6 15.79 6 18 L 18 18 C 18 15.79 15.32 14 12 14" styleClass="user-icon-svg" />
            </StackPane>
            <VBox>
                <children>
                    <Label fx:id="usernameLabel" styleClass="username-label" />
                    <Label fx:id="emailLabel" styleClass="user-email-label" />
                </children>
            </VBox>
        </children>
    </HBox>
    <Separator styleClass="separator-line" />

    <!-- Main Text Area -->
    <TextArea fx:id="threadTextArea" promptText="Write a thread..." styleClass="thread-textarea" stylesheets="@styles/post.css" VBox.vgrow="ALWAYS" />

    <!--
      =======================================================
      NEW: Image Preview Area
      =======================================================
    -->
    <VBox fx:id="imagePreviewContainer" alignment="CENTER" managed="false" spacing="5" visible="false">
        <children>
            <ImageView fx:id="imagePreview" fitHeight="150.0" fitWidth="250.0" pickOnBounds="true" preserveRatio="true" />
            <Button fx:id="removeImageButton" onAction="#onRemoveImage" styleClass="icon-button" text="Remove Image" />
        </children>
    </VBox>
    <!-- ======================================================= -->

    <!-- Bottom Bar: Image Icon and Post Button -->
    <BorderPane>
        <left>
            <!--
              THIS BUTTON IS NOW FUNCTIONAL
              - Added fx:id="attachImageButton"
              - Added onAction="#onAttachImage"
            -->
            <Button fx:id="attachImageButton" onAction="#onAttachImage" styleClass="icon-button">
                <graphic>
                    <StackPane styleClass="image-icon-pane">
                        <SVGPath content="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" styleClass="image-icon-svg" />
                    </StackPane>
                </graphic>
            </Button>
        </left>
        <right>
            <Button fx:id="postButton" styleClass="post-button" text="Post" />
        </right>
    </BorderPane>
</VBox>
